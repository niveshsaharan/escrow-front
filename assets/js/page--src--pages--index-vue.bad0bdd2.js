(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{iyQ6:function(t,e,r){"use strict";r.r(e);var n,a=r("U8pU"),s=r("uFwe"),o=r("HaE+"),c=(r("rB9j"),r("hByQ"),r("07d7"),r("PKPk"),r("3bBZ"),r("Kz25"),r("ma9I"),r("oVuX"),r("tkto"),r("2B1R"),r("sMBO"),r("mRH6"),r("fbCW"),r("ls82"),r("KkUu")),i=r("2u47");n=r("cCgg");var u={metaInfo:{title:"Create contract!"},data:function(){return{serviceProviderContract:c,erc20:i,serviceProviderAddress:"0x3CD9EC54DC09bB85C4E92656c6c4643d8e66618f",network:{default:"rinkeby",current:null,map:{137:"mainnet",80001:"mumbai"},list:{rinkeby:{web3Provider:"https://rinkeby.infura.io/v3/cd808238c8684678a97167ac62dc29b0",explorer:"https://rinkeby.etherscan.io",id:4,name:"Rinkeby Test Network"}}},metamask:{},makingTransaction:!1,transactionStarted:!1,formDisabled:!1,contract:{buyer:"0x3E1ECc904D9a356408e57126790438636439E291",creatorInputToken:"0x476f231a320d6E9C548420cac55Fbc5f74A55c31",buyerInputToken:"0x322c8115A858244936C20c87cFDc38Fb69e1cE14",creatorInputAmount:"10",buyerInputAmount:"800"},trx:{hash:"",link:""},service:null,contracts:{},contractIds:[],account:null}},computed:{},mounted:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.currentNetwork=t.getParam("network")||t.network.default,t.initDapp(),e.next=4,t.initWeb3(t.currentNetwork,!0);case 4:return e.next=6,t.initService(t.currentNetwork);case 6:return t.registerEvents(),e.next=9,t.loadContracts();case 9:case"end":return e.stop()}}),e)})))()},methods:{status:function(t){return{0:"Pending",1:"Completed",2:"Cancelled",3:"Paused"}[t]},registerEvents:function(){var t=this;window.ethereum&&window.ethereum.on("chainChanged",(function(e){t.metamask.netId=t.web3.utils.hexToNumber(e),t.initDapp()}))},getParam:function(t){var e=window.location.search;return new URLSearchParams(e).get(t)},initDapp:function(){this.network.current=this.network.list[this.currentNetwork],this.initWeb3(this.currentNetwork,!0)},initWeb3:function(t,e){var r=this;return Object(o.a)(regeneratorRuntime.mark((function a(){var s;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(r.network.list[t]){a.next=3;break}throw r.$toast.error("Failed initializing network ".concat(t,". Allowed values are ").concat(Object.keys(r.network.list).join(", "),".")),new Error("Failed initializing network ".concat(t,". Allowed values are ").concat(Object.keys(r.network.list).join(", "),"."));case 3:if(e&&void 0!==window.ethereum){a.next=9;break}r.network.current=r.network.list[t],r.web3Provider=new n.providers.HttpProvider(r.network.list[t].web3Provider),r.web3=new n(r.web3Provider),a.next=20;break;case 9:return r.web3Provider=window.ethereum,r.web3=new n(r.web3Provider),r.metamask.installed=r.web3Provider.isMetaMask,a.next=14,r.web3.eth.getChainId();case 14:if(s=a.sent,r.metamask.netId=s,s===r.network.list[t].id){a.next=20;break}return r.network.current=r.network.list[r.network.map[s]],a.next=20,r.initWeb3(t,!1);case 20:case"end":return a.stop()}}),a)})))()},initService:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.service=new t.web3.eth.Contract(t.serviceProviderContract.abi,t.serviceProviderAddress);case 1:case"end":return e.stop()}}),e)})))()},loadContracts:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,n,a,o,c,i,u,l,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.metamask.installed){e.next=3;break}return t.$toast.error("To create a Token please install MetaMask!"),e.abrupt("return");case 3:if(t.metamask.netId===t.network.current.id){e.next=6;break}return t.$toast.error("Your MetaMask in on the wrong network. Please switch on ".concat(t.network.current.name," and try again!")),e.abrupt("return");case 6:return r=null,t.getParam("id")&&(r=t.getParam("id")),n=null,t.getParam("status")&&(n=t.getParam("status")),a=null,t.getParam("with")&&(a=(a=t.getParam("with"))?a.toLowerCase():null),t.trx.hash="",t.trx.link="",t.formDisabled=!0,t.makingTransaction=!0,t.sourceCodeVerified=!1,t.verificationCount=0,e.next=20,t.web3Provider.request({method:"eth_requestAccounts"});case 20:return e.sent,e.next=23,t.web3.eth.getCoinbase();case 23:if(o=e.sent,t.account=o,{from:o},!r){e.next=30;break}t.contractIds=[r],e.next=33;break;case 30:return e.next=32,t.service.methods.contractsOf(o).call();case 32:t.contractIds=e.sent;case 33:c={},i=Object(s.a)(t.contractIds),e.prev=35,i.s();case 37:if((u=i.n()).done){e.next=45;break}return l=u.value,e.next=41,t.service.methods.find(l).call();case 41:(m=e.sent)&&(n&&t.status(m.status)!==n||a&&m.creator.toLowerCase()!==a&&m.buyer.toLowerCase()!==a||(c[l]={id:m.id,creator:m.creator,buyer:m.buyer,creatorInputToken:m.creatorInputToken,buyerInputToken:m.buyerInputToken,creatorInputAmount:t.web3.utils.fromWei(m.creatorInputAmount,"ether"),buyerInputAmount:t.web3.utils.fromWei(m.buyerInputAmount,"ether"),status:m.status}));case 43:e.next=37;break;case 45:e.next=50;break;case 47:e.prev=47,e.t0=e.catch(35),i.e(e.t0);case 50:return e.prev=50,i.f(),e.finish(50);case 53:t.contracts=c;case 54:case"end":return e.stop()}}),e,null,[[35,47,50,53]])})))()},estimateGas:function(t,e){var r=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.service.methods.create(t).estimateGas(e).catch((function(t){r.$toast.error(t)}));case 2:return a=n.sent,n.abrupt("return",a);case 4:case"end":return n.stop()}}),n)})))()},complete:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var n,a,s,o,c,i,u,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.trx.hash="",e.trx.link="",e.formDisabled=!0,e.makingTransaction=!0,e.sourceCodeVerified=!1,e.verificationCount=0,r.next=8,e.web3Provider.request({method:"eth_requestAccounts"});case 8:return r.next=10,e.web3.eth.getCoinbase();case 10:if(n=r.sent,a={from:n},s=e.contracts[t],o=e.web3.utils.toWei(s.creatorInputAmount,"ether"),c=e.web3.utils.toWei(s.buyerInputAmount,"ether"),"0x0000000000000000000000000000000000000000"===s.buyerInputToken){r.next=31;break}return i=new e.web3.eth.Contract(e.erc20.abi,s.buyerInputToken),r.next=19,i.methods.allowance(n,e.serviceProviderAddress).call();case 19:if(!(r.sent<o)){r.next=29;break}return e.$toast.info("You need to approve!"),r.next=24,i.methods.approve(e.serviceProviderAddress,e.web3.utils.toWei(o,"ether")).send(a).on("error",(function(t){e.makingTransaction=!1,e.formDisabled=!1,e.$toast.error(t.message)})).on("transactionHash",(function(t){console.log(t),e.$toast.info("Approval hash received"),e.transactionStarted=!0})).on("receipt",(function(t){console.log(t),e.$forceUpdate(),e.$toast.success("Well done! Approval request success!")}));case 24:u=r.sent,console.log(u),r.next=29;break;case 29:r.next=32;break;case 31:a.value=c;case 32:return r.next=34,e.service.methods.complete(t).estimateGas(a).catch((function(t){e.$toast.error(t)}));case 34:if(l=r.sent){r.next=37;break}return r.abrupt("return");case 37:a.gas=l,e.service.methods.complete(t).send(a).on("error",(function(t){e.makingTransaction=!1,e.formDisabled=!1,e.$toast.error(t.message)})).on("transactionHash",(function(t){e.transactionStarted=!0,e.trx.hash=t,e.trx.link="".concat(e.network.current.explorer,"/tx/").concat(e.trx.hash)})).on("receipt",(function(r){console.log(r),e.$forceUpdate(),e.$toast.success("Well done! Your contract was completed!"),e.loadContracts(t)}));case 39:case"end":return r.stop()}}),r)})))()},cancel:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var n,s,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.trx.hash="",e.trx.link="",e.formDisabled=!0,e.makingTransaction=!0,e.sourceCodeVerified=!1,e.verificationCount=0,r.next=8,e.web3Provider.request({method:"eth_requestAccounts"});case 8:return r.next=10,e.web3.eth.getCoinbase();case 10:return n=r.sent,s={from:n},r.next=14,e.service.methods.cancel(t).estimateGas(s).catch((function(t,r){e.$toast.error(t),console.table(Object(a.a)(t.message))}));case 14:if(o=r.sent){r.next=17;break}return r.abrupt("return");case 17:s.gas=o,e.service.methods.cancel(t).send(s).on("error",(function(t){e.makingTransaction=!1,e.formDisabled=!1,e.$toast.error(t.message)})).on("transactionHash",(function(t){e.transactionStarted=!0,e.trx.hash=t,e.trx.link="".concat(e.network.current.explorer,"/tx/").concat(e.trx.hash)})).on("receipt",(function(r){console.log(r),e.$forceUpdate(),e.$toast.success("Your contract was cancelled!"),e.loadContracts(t)}));case 19:case"end":return r.stop()}}),r)})))()}}},l=r("KHd+"),m=Object(l.a)(u,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("Layout",[r("div",{staticClass:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},[[r("div",{staticClass:"w-full max-w-7xl mx-auto xl:px-8"},[t.metamask.installed?t.account?r("div",[t._v("\n            You are transacting as "+t._s(t.account)+"\n          ")]):t._e():r("div",[r("div",{staticClass:"p-4 bg-yellow-100 text-yellow-700 text-base border-yellow-400"},[r("h4",{staticClass:"text-xl font-semibold mb-1"},[t._v("\n                Attention!\n              ")]),r("p",[t._v("\n                This app is tested with "),r("a",{staticClass:"underline",attrs:{href:"https://metamask.io/",target:"_blank"}},[t._v("MetaMask")]),t._v(" wallet only. Use any other wallet at your own risk.\n              ")])])]),r("div",{staticClass:"mt-2"},[r("g-link",{staticClass:"mt-2 text-blue-600 underline",attrs:{to:"/create"}},[t._v("Create new contract")])],1),r("div",{staticClass:"mt-4 md:flex md:space-x-10"},[r("div",{staticClass:"flex-1  "},[r("h2",{staticClass:"p-3 bg-gray-700 text-white"},[t._v("\n                My Contracts\n              ")]),r("div",{staticClass:"px-4 pt-3 pb-6 grid grid-cols-1 border-t-0 border-2 border-gray-300 gap-y-6 bg-white "},[Object.keys(t.contracts).length?r("ul",{staticClass:"divide-y divide-gray-200 space-y-2"},t._l(t.contracts,(function(e){return r("li",{key:e.id,staticClass:"py-4 flex flex-col"},[r("div",{staticClass:"mt-2"},[r("p",{staticClass:"text-sm font-medium text-gray-900"},[t._v("ID")]),r("p",{staticClass:"text-sm text-gray-500"},[t._v(t._s(e.id))])]),r("div",{staticClass:"mt-2"},[r("p",{staticClass:"text-sm font-medium text-gray-900"},[t._v("Creator")]),r("p",{staticClass:"text-sm text-gray-500"},[t._v(t._s(e.creator))])]),r("div",{staticClass:"mt-2"},[r("p",{staticClass:"text-sm font-medium text-gray-900"},[t._v("Buyer")]),r("p",{staticClass:"text-sm text-gray-500"},[t._v(t._s(e.buyer))])]),r("div",{staticClass:"mt-2"},[r("p",{staticClass:"text-sm font-medium text-gray-900"},[t._v("Item")]),r("p",{staticClass:"text-sm text-gray-500"},[t._v(t._s(e.creatorInputToken))])]),r("div",{staticClass:"mt-2"},[r("p",{staticClass:"text-sm font-medium text-gray-900"},[t._v("Currency")]),r("p",{staticClass:"text-sm text-gray-500"},[t._v(t._s(e.buyerInputToken))])]),r("div",{staticClass:"mt-2"},[r("p",{staticClass:"text-sm font-medium text-gray-900"},[t._v("Quantity")]),r("p",{staticClass:"text-sm text-gray-500"},[t._v(t._s(e.creatorInputAmount))])]),r("div",{staticClass:"mt-2"},[r("p",{staticClass:"text-sm font-medium text-gray-900"},[t._v("Amount")]),r("p",{staticClass:"text-sm text-gray-500"},[t._v(t._s(e.buyerInputAmount))])]),r("div",{staticClass:"mt-2"},[r("p",{staticClass:"text-sm font-medium text-gray-900"},[t._v("Status")]),r("p",{staticClass:"text-sm text-gray-500"},[t._v(t._s(t.status(e.status)))])]),"0"===e.status?r("div",{staticClass:"mt-2"},[r("p",{staticClass:"text-sm font-medium text-gray-900"},[t._v("Action")]),r("p",{staticClass:"text-sm text-gray-500"},[t.account.toLowerCase()===e.creator.toLowerCase()?r("button",{staticClass:"px-3 py-2 bg-yellow-300",on:{click:function(r){return t.cancel(e.id)}}},[t._v("Cancel")]):t._e(),t.account.toLowerCase()===e.buyer.toLowerCase()?r("button",{staticClass:"px-3 py-2 bg-green-300",on:{click:function(r){return t.complete(e.id)}}},[t._v("Complete")]):t._e()])]):t._e()])})),0):r("p",[t._v("No contract found. Create one")])])])])])]],2)])}),[],!1,null,null,null);e.default=m.exports}}]);